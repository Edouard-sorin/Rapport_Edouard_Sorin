<!DOCTYPE html>
<html lang="fr-FR" xml:lang="fr-FR">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Annexe | Amélioration de la surveillance épidémiologique du « greening » des agrumes infectés par le Huanglongbing à La Réunion par Spectroscopie Proche Infra-Rouge</title>
  <meta name="description" content="Modèle de livre écrit avec bookdown." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Annexe | Amélioration de la surveillance épidémiologique du « greening » des agrumes infectés par le Huanglongbing à La Réunion par Spectroscopie Proche Infra-Rouge" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Modèle de livre écrit avec bookdown." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Annexe | Amélioration de la surveillance épidémiologique du « greening » des agrumes infectés par le Huanglongbing à La Réunion par Spectroscopie Proche Infra-Rouge" />
  
  <meta name="twitter:description" content="Modèle de livre écrit avec bookdown." />
  



<meta name="date" content="2021-07-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="conclusion.html"/>
<link rel="next" href="bibliographie.html"/>
<style type="text/css">
p.abstract{
  text-align: center;
  font-weight: bold;
}
div.abstract{
  margin: auto;
  width: 90%;
}
</style>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Ouvrage Edouard</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Remerciements</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#contexte-général"><i class="fa fa-check"></i><b>1.1</b> Contexte général</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#etat-des-connaissances-sur-la-maladie"><i class="fa fa-check"></i><b>1.2</b> Etat des connaissances sur la maladie</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#la-résurgence-du-hlb-à-la-réunion"><i class="fa fa-check"></i><b>1.3</b> La résurgence du HLB à la Réunion</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="matériel-et-méthodes.html"><a href="matériel-et-méthodes.html"><i class="fa fa-check"></i><b>2</b> Matériel et Méthodes</a>
<ul>
<li class="chapter" data-level="2.1" data-path="matériel-et-méthodes.html"><a href="matériel-et-méthodes.html#identification-de-la-maladie"><i class="fa fa-check"></i><b>2.1</b> Identification de la maladie</a></li>
<li class="chapter" data-level="2.2" data-path="matériel-et-méthodes.html"><a href="matériel-et-méthodes.html#choix-des-arbres"><i class="fa fa-check"></i><b>2.2</b> Choix des arbres</a></li>
<li class="chapter" data-level="2.3" data-path="matériel-et-méthodes.html"><a href="matériel-et-méthodes.html#spectroscopie-à-main"><i class="fa fa-check"></i><b>2.3</b> Spectroscopie à main</a></li>
<li class="chapter" data-level="2.4" data-path="matériel-et-méthodes.html"><a href="matériel-et-méthodes.html#traitement-des-données-par-analyses-statistiques-et-apprentissage-supervisé"><i class="fa fa-check"></i><b>2.4</b> Traitement des données par analyses statistiques et apprentissage supervisé</a></li>
<li class="chapter" data-level="2.5" data-path="matériel-et-méthodes.html"><a href="matériel-et-méthodes.html#forêts-aléatoires-rf"><i class="fa fa-check"></i><b>2.5</b> Forêts Aléatoires (RF)</a></li>
<li class="chapter" data-level="2.6" data-path="matériel-et-méthodes.html"><a href="matériel-et-méthodes.html#machine-à-vecteurs-de-support-svm"><i class="fa fa-check"></i><b>2.6</b> Machine à Vecteurs de Support (SVM)</a></li>
<li class="chapter" data-level="2.7" data-path="matériel-et-méthodes.html"><a href="matériel-et-méthodes.html#régression-par-les-moindres-carrés-partiels-pls"><i class="fa fa-check"></i><b>2.7</b> Régression par les Moindres Carrés Partiels (PLS)</a></li>
<li class="chapter" data-level="2.8" data-path="matériel-et-méthodes.html"><a href="matériel-et-méthodes.html#performance-des-classifications"><i class="fa fa-check"></i><b>2.8</b> Performance des classifications</a></li>
<li class="chapter" data-level="2.9" data-path="matériel-et-méthodes.html"><a href="matériel-et-méthodes.html#amélioration-du-protocole-de-terrain"><i class="fa fa-check"></i><b>2.9</b> Amélioration du protocole de terrain</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="résultats.html"><a href="résultats.html"><i class="fa fa-check"></i><b>3</b> Résultats</a>
<ul>
<li class="chapter" data-level="3.1" data-path="résultats.html"><a href="résultats.html#influence-du-lieu-déchantillonnage-et-des-variétés-sur-le-spectre-de-réflectance-global"><i class="fa fa-check"></i><b>3.1</b> Influence du lieu d’échantillonnage et des variétés sur le spectre de réflectance global</a></li>
<li class="chapter" data-level="3.2" data-path="résultats.html"><a href="résultats.html#effet-du-statut-hlb-sur-les-spectres-de-réflectance"><i class="fa fa-check"></i><b>3.2</b> Effet du statut HLB sur les spectres de réflectance</a></li>
<li class="chapter" data-level="3.3" data-path="résultats.html"><a href="résultats.html#lapproche-par-arbre-de-décision"><i class="fa fa-check"></i><b>3.3</b> L’approche par arbre de décision</a></li>
<li class="chapter" data-level="3.4" data-path="résultats.html"><a href="résultats.html#comparaison-des-performances-des-trois-méthodes-de-prédiction-du-statut-hlb-à-partir-des-spectres-réflectance"><i class="fa fa-check"></i><b>3.4</b> Comparaison des performances des trois méthodes de prédiction du statut HLB à partir des spectres réflectance</a></li>
<li class="chapter" data-level="3.5" data-path="résultats.html"><a href="résultats.html#prédiction-du-statut-hlb-par-régression-par-les-moindres-carrés-partiels-pls"><i class="fa fa-check"></i><b>3.5</b> Prédiction du statut HLB par Régression par les Moindres Carrés Partiels (PLS)</a></li>
<li class="chapter" data-level="3.6" data-path="résultats.html"><a href="résultats.html#amélioration-du-protocole-de-terrain-pour-le-choix-du-nombre-de-feuilles-par-arbre"><i class="fa fa-check"></i><b>3.6</b> Amélioration du protocole de terrain pour le choix du nombre de feuilles par arbre</a></li>
<li class="chapter" data-level="3.7" data-path="résultats.html"><a href="résultats.html#amélioration-du-protocole-de-terrain-pour-le-choix-du-nombre-de-mesures-de-réflectance-par-feuille"><i class="fa fa-check"></i><b>3.7</b> Amélioration du protocole de terrain pour le choix du nombre de mesures de réflectance par feuille</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>4</b> Discussion</a></li>
<li class="chapter" data-level="5" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>5</b> Conclusion</a></li>
<li class="chapter" data-level="6" data-path="annexe.html"><a href="annexe.html"><i class="fa fa-check"></i><b>6</b> Annexe</a>
<ul>
<li class="chapter" data-level="6.1" data-path="annexe.html"><a href="annexe.html#annexe-1-importation-des-données-brutes"><i class="fa fa-check"></i><b>6.1</b> Annexe 1 : Importation des données brutes</a></li>
<li class="chapter" data-level="6.2" data-path="annexe.html"><a href="annexe.html#annexe-2-fonction-matrice-de-confusion"><i class="fa fa-check"></i><b>6.2</b> Annexe 2 : Fonction Matrice de confusion</a></li>
<li class="chapter" data-level="6.3" data-path="annexe.html"><a href="annexe.html#annexe-3-matrice-de-confusion-des-3-méthodes-de-machin-learning"><i class="fa fa-check"></i><b>6.3</b> Annexe 3 : Matrice de confusion des 3 méthodes de machin learning</a></li>
<li class="chapter" data-level="6.4" data-path="annexe.html"><a href="annexe.html#annexe-4-fonction-nombre-de-feuille"><i class="fa fa-check"></i><b>6.4</b> Annexe 4 : Fonction nombre de feuille</a></li>
<li class="chapter" data-level="6.5" data-path="annexe.html"><a href="annexe.html#annexe-5-prédiction-du-nombre-optimal-de-feuille"><i class="fa fa-check"></i><b>6.5</b> Annexe 5 : Prédiction du nombre optimal de feuille</a></li>
<li class="chapter" data-level="6.6" data-path="annexe.html"><a href="annexe.html#annexe-6-fonction-nombre-de-répétition-spir-par-feuille"><i class="fa fa-check"></i><b>6.6</b> Annexe 6 : Fonction nombre de répétition SPIR par feuille</a></li>
<li class="chapter" data-level="6.7" data-path="annexe.html"><a href="annexe.html#annexe-7-prédiction-du-nombre-de-répétition-optimal"><i class="fa fa-check"></i><b>6.7</b> Annexe 7 : Prédiction du nombre de répétition optimal</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bibliographie.html"><a href="bibliographie.html"><i class="fa fa-check"></i>Bibliographie</a></li>
<li class="divider"></li>
<li><a href="https://github.com/Edouard-sorin/Rapport_Edouard_Sorin_2021.git" target="blank">Hébergé sur GitHub sur la page :</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Amélioration de la surveillance épidémiologique du « greening » des agrumes infectés par le Huanglongbing à La Réunion par Spectroscopie Proche Infra-Rouge</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="annexe" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Annexe</h1>
<p></p>
<p></p>
<div id="annexe-1-importation-des-données-brutes" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Annexe 1 : Importation des données brutes</h2>
<p></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="annexe.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(tidyr)  <span class="co"># pivot longer &amp; pivot_wider</span></span>
<span id="cb1-2"><a href="annexe.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Importation des donnees SPIR Global ####</span></span>
<span id="cb1-3"><a href="annexe.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> data_SPIR_Ed <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">file =</span> <span class="st">&quot;SPIR_Global.csv&quot;</span>, </span>
<span id="cb1-4"><a href="annexe.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">stringsAsFactors =</span> T, <span class="at">row.names =</span> <span class="dv">1</span>, </span>
<span id="cb1-5"><a href="annexe.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;NA&quot;</span>), <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb1-6"><a href="annexe.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Creation des colonne &#39;code&#39; de data_SPIR_Ed</span></span>
<span id="cb1-7"><a href="annexe.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> code_labo <span class="ot">&lt;-</span> <span class="fu">rownames</span>(data_SPIR_Ed)</span>
<span id="cb1-8"><a href="annexe.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">names</span>(data_SPIR_Ed)[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;code_variete&quot;</span>)</span>
<span id="cb1-9"><a href="annexe.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">names</span>(data_SPIR_Ed)[<span class="dv">2</span>] <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;code_agri&quot;</span>)</span>
<span id="cb1-10"><a href="annexe.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_SPIR_Ed<span class="sc">$</span>code_nbr_rep <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">substr</span>(code_labo, </span>
<span id="cb1-11"><a href="annexe.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb1-12"><a href="annexe.html#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_SPIR_Ed<span class="sc">$</span>code_ech_arbre <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">substr</span>(code_labo, </span>
<span id="cb1-13"><a href="annexe.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb1-14"><a href="annexe.html#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_SPIR_Ed<span class="sc">$</span>code_ech_feuille <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">substr</span>(code_labo, </span>
<span id="cb1-15"><a href="annexe.html#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb1-16"><a href="annexe.html#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_SPIR_Ed<span class="sc">$</span>code_rep_feuille <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">paste</span>(data_SPIR_Ed<span class="sc">$</span>code_ech_feuille, </span>
<span id="cb1-17"><a href="annexe.html#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     data_SPIR_Ed<span class="sc">$</span>code_nbr_rep, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb1-18"><a href="annexe.html#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rm</span>(code_labo)</span>
<span id="cb1-19"><a href="annexe.html#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_SPIR_Ed <span class="ot">&lt;-</span> data_SPIR_Ed[<span class="sc">!</span><span class="fu">is.na</span>(data_SPIR_Ed<span class="sc">$</span>X350), </span>
<span id="cb1-20"><a href="annexe.html#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     ]</span>
<span id="cb1-21"><a href="annexe.html#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Importation et preparation des resultats de la</span></span>
<span id="cb1-22"><a href="annexe.html#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># Qpcr Globaux ####</span></span>
<span id="cb1-23"><a href="annexe.html#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> data_Qpcr_Ed <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">file =</span> <span class="st">&quot;qPCR_global_Ed.csv&quot;</span>, </span>
<span id="cb1-24"><a href="annexe.html#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">stringsAsFactors =</span> T, <span class="at">row.names =</span> <span class="dv">1</span>, </span>
<span id="cb1-25"><a href="annexe.html#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;NA&quot;</span>), <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb1-26"><a href="annexe.html#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># on stocke les noms d&#39;echantillons positifs selon</span></span>
<span id="cb1-27"><a href="annexe.html#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># nos 2 seuils de Ct (cycle de qPCR ), a savoir</span></span>
<span id="cb1-28"><a href="annexe.html#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># moins de 32 cyclces et moins de 36 cycles qPCR</span></span>
<span id="cb1-29"><a href="annexe.html#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> seuils <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">32</span>, <span class="dv">36</span>)</span>
<span id="cb1-30"><a href="annexe.html#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> trueP <span class="ot">&lt;-</span> <span class="fu">lapply</span>(seuils, <span class="cf">function</span>(x) <span class="fu">unique</span>(data_Qpcr_Ed<span class="sc">$</span>Sample.Name[<span class="fu">which</span>(data_Qpcr_Ed<span class="sc">$</span>C..Mean <span class="sc">&lt;</span> </span>
<span id="cb1-31"><a href="annexe.html#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     x <span class="sc">&amp;</span> data_Qpcr_Ed<span class="sc">$</span>C..SD <span class="sc">&lt;</span> <span class="dv">1</span>)]))</span>
<span id="cb1-32"><a href="annexe.html#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">names</span>(trueP) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;seuil&quot;</span>, seuils, <span class="at">sep =</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb1-33"><a href="annexe.html#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_SPIR_Ed[<span class="fu">paste</span>(<span class="st">&quot;qPCR&quot;</span>, seuils, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(trueP, </span>
<span id="cb1-34"><a href="annexe.html#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(data_SPIR_Ed<span class="sc">$</span>code_ech_arbre <span class="sc">%in%</span> </span>
<span id="cb1-35"><a href="annexe.html#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         x))</span>
<span id="cb1-36"><a href="annexe.html#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># on cherche quels sont les code_ech_arbre qui se</span></span>
<span id="cb1-37"><a href="annexe.html#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># trouvent dans le vecteur x x reprenant</span></span>
<span id="cb1-38"><a href="annexe.html#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># automatiquement les noms des arbres positifs</span></span>
<span id="cb1-39"><a href="annexe.html#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># selon le seuil choisi</span></span>
<span id="cb1-40"><a href="annexe.html#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> select.lambda <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;^X&quot;</span>, <span class="fu">names</span>(data_SPIR_Ed))</span>
<span id="cb1-41"><a href="annexe.html#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_SPIR_Ed <span class="ot">&lt;-</span> data_SPIR_Ed[, <span class="fu">c</span>(<span class="fu">names</span>(data_SPIR_Ed)[<span class="sc">-</span>select.lambda], </span>
<span id="cb1-42"><a href="annexe.html#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="fu">names</span>(data_SPIR_Ed)[select.lambda])]</span>
<span id="cb1-43"><a href="annexe.html#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rm</span>(data_Qpcr_Ed, select.lambda, seuils)</span>
<span id="cb1-44"><a href="annexe.html#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_SPIR_Ed[<span class="fu">c</span>(<span class="st">&quot;qPCR_32&quot;</span>, <span class="st">&quot;qPCR_36&quot;</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(data_SPIR_Ed[<span class="fu">c</span>(<span class="st">&quot;qPCR_32&quot;</span>, </span>
<span id="cb1-45"><a href="annexe.html#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="st">&quot;qPCR_36&quot;</span>)], factor)</span>
<span id="cb1-46"><a href="annexe.html#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Format_long ####</span></span>
<span id="cb1-47"><a href="annexe.html#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> select.lambda <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;^X&quot;</span>, <span class="fu">names</span>(data_SPIR_Ed))</span>
<span id="cb1-48"><a href="annexe.html#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_long_Ed <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(<span class="at">data =</span> data_SPIR_Ed, <span class="at">cols =</span> select.lambda, </span>
<span id="cb1-49"><a href="annexe.html#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">values_to =</span> <span class="st">&quot;reflectance&quot;</span>, <span class="at">names_to =</span> <span class="st">&quot;lambda&quot;</span>)</span>
<span id="cb1-50"><a href="annexe.html#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_long_Ed<span class="sc">$</span>lambda <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;&quot;</span>, data_long_Ed<span class="sc">$</span>lambda))</span>
<span id="cb1-51"><a href="annexe.html#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_long_Ed <span class="ot">&lt;-</span> data_long_Ed[<span class="sc">!</span><span class="fu">is.na</span>(data_long_Ed<span class="sc">$</span>reflectance), </span>
<span id="cb1-52"><a href="annexe.html#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     ]</span></code></pre></div>
<p></p>
</div>
<div id="annexe-2-fonction-matrice-de-confusion" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Annexe 2 : Fonction Matrice de confusion</h2>
<p></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="annexe.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fct_ConfusionMatrix <span class="ot">&lt;-</span> <span class="cf">function</span>(nb.rep, seuil.ct, list.feuilles) {</span>
<span id="cb2-2"><a href="annexe.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     maliste <span class="ot">&lt;-</span> <span class="fu">lapply</span>(list.feuilles, <span class="cf">function</span>(feuille) {</span>
<span id="cb2-3"><a href="annexe.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         list_svm <span class="ot">&lt;-</span> feuille[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(feuille<span class="sc">$</span>code_ech_feuille), </span>
<span id="cb2-4"><a href="annexe.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             nb.rep), ]</span>
<span id="cb2-5"><a href="annexe.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="co"># on fait ça pour tte les feuilles mais tjrs en</span></span>
<span id="cb2-6"><a href="annexe.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="co"># choisissant le nombre de rep tire aleatoirement</span></span>
<span id="cb2-7"><a href="annexe.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         code <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;^code_ech&quot;</span>, <span class="fu">names</span>(list_svm))</span>
<span id="cb2-8"><a href="annexe.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         qPCR <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;^qPCR_&quot;</span>, <span class="fu">names</span>(list_svm))</span>
<span id="cb2-9"><a href="annexe.html#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         sortie <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="fu">unique</span>(list_svm[<span class="fu">c</span>(code, </span>
<span id="cb2-10"><a href="annexe.html#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             qPCR)]), <span class="fu">matrix</span>(<span class="fu">apply</span>(list_svm[<span class="sc">-</span>(<span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb2-11"><a href="annexe.html#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="st">&quot;code_variete&quot;</span>)<span class="sc">:</span><span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb2-12"><a href="annexe.html#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="st">&quot;qPCR_36&quot;</span>))], <span class="dv">2</span>, mean), <span class="at">nr =</span> <span class="dv">1</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, </span>
<span id="cb2-13"><a href="annexe.html#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="fu">names</span>(list_svm)[<span class="sc">-</span>(<span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb2-14"><a href="annexe.html#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="st">&quot;code_variete&quot;</span>)<span class="sc">:</span><span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb2-15"><a href="annexe.html#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="st">&quot;qPCR_36&quot;</span>))])))</span>
<span id="cb2-16"><a href="annexe.html#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         sortie</span>
<span id="cb2-17"><a href="annexe.html#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     })</span>
<span id="cb2-18"><a href="annexe.html#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     test_ed <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, maliste)  <span class="co"># on colle toute les listes créées précédement </span></span>
<span id="cb2-19"><a href="annexe.html#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     test_ed <span class="ot">&lt;-</span> test_ed[<span class="sc">-</span>(<span class="fu">which</span>(<span class="fu">colnames</span>(test_ed) <span class="sc">==</span> </span>
<span id="cb2-20"><a href="annexe.html#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="st">&quot;qPCR_32&quot;</span>))]</span>
<span id="cb2-21"><a href="annexe.html#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     test_ed[[<span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, seuil.ct)]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(test_ed[[<span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, </span>
<span id="cb2-22"><a href="annexe.html#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         seuil.ct)]]))</span>
<span id="cb2-23"><a href="annexe.html#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     decoup <span class="ot">&lt;-</span> <span class="fu">sample.split</span>(test_ed[, <span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, </span>
<span id="cb2-24"><a href="annexe.html#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         seuil.ct)], <span class="at">SplitRatio =</span> <span class="fl">0.5</span>)  <span class="co"># on decoupe le jeu de donné en training set et test set</span></span>
<span id="cb2-25"><a href="annexe.html#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     training_set <span class="ot">&lt;-</span> test_ed[decoup, ]</span>
<span id="cb2-26"><a href="annexe.html#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     test_set <span class="ot">&lt;-</span> test_ed[<span class="sc">!</span>decoup, ]</span>
<span id="cb2-27"><a href="annexe.html#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Criteres choisi pour la separation des donnees</span></span>
<span id="cb2-28"><a href="annexe.html#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     crit.pos <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb2-29"><a href="annexe.html#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     crit.neg <span class="ot">&lt;-</span> <span class="fl">0.35</span></span>
<span id="cb2-30"><a href="annexe.html#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     trueP<span class="sc">$</span>seuil<span class="fl">.32</span> <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb2-31"><a href="annexe.html#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Prediction RF ####</span></span>
<span id="cb2-32"><a href="annexe.html#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     model_rf_36 <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="at">x =</span> training_set[, </span>
<span id="cb2-33"><a href="annexe.html#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="fu">grep</span>(<span class="st">&quot;^X&quot;</span>, <span class="fu">names</span>(training_set))], <span class="at">y =</span> training_set[[<span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, </span>
<span id="cb2-34"><a href="annexe.html#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         seuil.ct)]], <span class="at">ntree =</span> <span class="dv">100</span>)</span>
<span id="cb2-35"><a href="annexe.html#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Prediction sur les feuilles de la base</span></span>
<span id="cb2-36"><a href="annexe.html#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># d&#39;apprentissage</span></span>
<span id="cb2-37"><a href="annexe.html#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     rf_pred <span class="ot">&lt;-</span> test_set</span>
<span id="cb2-38"><a href="annexe.html#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     rf_pred<span class="sc">$</span>rf_pred_36 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rf_36, <span class="at">newdata =</span> test_set, </span>
<span id="cb2-39"><a href="annexe.html#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">decision.values =</span> T)</span>
<span id="cb2-40"><a href="annexe.html#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Conversion des resultats de la prediction en</span></span>
<span id="cb2-41"><a href="annexe.html#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># numerique</span></span>
<span id="cb2-42"><a href="annexe.html#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     rf_pred<span class="sc">$</span>rf_pred_36 <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(rf_pred<span class="sc">$</span>rf_pred_36))</span>
<span id="cb2-43"><a href="annexe.html#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Moyennage des resultats de la prediction pour</span></span>
<span id="cb2-44"><a href="annexe.html#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># chaque arbres</span></span>
<span id="cb2-45"><a href="annexe.html#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     rf_pred_arbres_36 <span class="ot">=</span> <span class="fu">aggregate</span>(rf_pred_36 <span class="sc">~</span> code_ech_arbre, </span>
<span id="cb2-46"><a href="annexe.html#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">data =</span> rf_pred, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb2-47"><a href="annexe.html#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     rf_pred_arbres_36<span class="sc">$</span>crit <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb2-48"><a href="annexe.html#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     rf_pred_arbres_36<span class="sc">$</span>crit[rf_pred_arbres_36<span class="sc">$</span>rf_pred_36 <span class="sc">&gt;=</span> </span>
<span id="cb2-49"><a href="annexe.html#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         crit.pos] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-50"><a href="annexe.html#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     rf_pred_arbres_36<span class="sc">$</span>crit[rf_pred_arbres_36<span class="sc">$</span>rf_pred_36 <span class="sc">&lt;=</span> </span>
<span id="cb2-51"><a href="annexe.html#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         crit.neg] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-52"><a href="annexe.html#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Creation d&#39;une nouvelle colonne des resulats issu</span></span>
<span id="cb2-53"><a href="annexe.html#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># de la qPCR, pour comparer à la valeurs predite</span></span>
<span id="cb2-54"><a href="annexe.html#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     rf_pred_arbres_36[<span class="fu">paste</span>(<span class="st">&quot;qPCR&quot;</span>, seuil.ct, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(trueP, </span>
<span id="cb2-55"><a href="annexe.html#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(rf_pred_arbres_36<span class="sc">$</span>code_ech_arbre <span class="sc">%in%</span> </span>
<span id="cb2-56"><a href="annexe.html#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             x))</span>
<span id="cb2-57"><a href="annexe.html#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Résultats de la prédiction sous forme de matrice</span></span>
<span id="cb2-58"><a href="annexe.html#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># de confusion</span></span>
<span id="cb2-59"><a href="annexe.html#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     rf_pred_arbres_36<span class="sc">$</span>crit <span class="ot">&lt;-</span> <span class="fu">factor</span>(rf_pred_arbres_36<span class="sc">$</span>crit, </span>
<span id="cb2-60"><a href="annexe.html#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb2-61"><a href="annexe.html#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     rf_confusion_matrix_36 <span class="ot">&lt;-</span> <span class="fu">ftable</span>(qPCR_36 <span class="sc">~</span> crit, </span>
<span id="cb2-62"><a href="annexe.html#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">data =</span> rf_pred_arbres_36)</span>
<span id="cb2-63"><a href="annexe.html#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     rf_confusion_matrix_36 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(rf_confusion_matrix_36)</span>
<span id="cb2-64"><a href="annexe.html#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     TP_rf <span class="ot">&lt;-</span> rf_confusion_matrix_36[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb2-65"><a href="annexe.html#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     TN_rf <span class="ot">&lt;-</span> rf_confusion_matrix_36[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb2-66"><a href="annexe.html#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     FN_rf <span class="ot">&lt;-</span> rf_confusion_matrix_36[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb2-67"><a href="annexe.html#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     FP_rf <span class="ot">&lt;-</span> rf_confusion_matrix_36[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb2-68"><a href="annexe.html#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Calcul des parametres rf de la matrice de</span></span>
<span id="cb2-69"><a href="annexe.html#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># confusion</span></span>
<span id="cb2-70"><a href="annexe.html#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Accuracy_rf36 <span class="ot">&lt;-</span> ((TP_rf <span class="sc">+</span> TN_rf)<span class="sc">/</span>(TP_rf <span class="sc">+</span> TN_rf <span class="sc">+</span> </span>
<span id="cb2-71"><a href="annexe.html#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         FN_rf <span class="sc">+</span> FP_rf) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb2-72"><a href="annexe.html#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Precision_rf36 <span class="ot">&lt;-</span> ((TP_rf<span class="sc">/</span>(TP_rf <span class="sc">+</span> FP_rf) <span class="sc">*</span> <span class="dv">100</span>))</span>
<span id="cb2-73"><a href="annexe.html#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Sensitivity_rf36 <span class="ot">&lt;-</span> ((TP_rf<span class="sc">/</span>(TP_rf <span class="sc">+</span> FN_rf) <span class="sc">*</span> <span class="dv">100</span>))</span>
<span id="cb2-74"><a href="annexe.html#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Parametre_rf_36 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Accuracy_rf36, Precision_rf36, </span>
<span id="cb2-75"><a href="annexe.html#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         Sensitivity_rf36)</span>
<span id="cb2-76"><a href="annexe.html#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Prediction SVM ####</span></span>
<span id="cb2-77"><a href="annexe.html#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     model_SVM_36 <span class="ot">&lt;-</span> <span class="fu">svm</span>(<span class="at">y =</span> training_set[, <span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, </span>
<span id="cb2-78"><a href="annexe.html#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         seuil.ct)], <span class="at">x =</span> training_set[, <span class="fu">grep</span>(<span class="st">&quot;^X&quot;</span>, <span class="fu">names</span>(training_set))], </span>
<span id="cb2-79"><a href="annexe.html#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">type =</span> <span class="st">&quot;C-classification&quot;</span>, <span class="at">kernel =</span> <span class="st">&quot;linear&quot;</span>)</span>
<span id="cb2-80"><a href="annexe.html#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Prediction sur le test_set</span></span>
<span id="cb2-81"><a href="annexe.html#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_pred <span class="ot">&lt;-</span> test_set</span>
<span id="cb2-82"><a href="annexe.html#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_pred<span class="sc">$</span>svm_pred_36 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_SVM_36, <span class="at">newdata =</span> test_set[, </span>
<span id="cb2-83"><a href="annexe.html#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="fu">grep</span>(<span class="st">&quot;^X&quot;</span>, <span class="fu">names</span>(test_set))], <span class="at">decision.values =</span> T)</span>
<span id="cb2-84"><a href="annexe.html#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Conversion des resultats de la prediction en</span></span>
<span id="cb2-85"><a href="annexe.html#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># numerique</span></span>
<span id="cb2-86"><a href="annexe.html#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_pred<span class="sc">$</span>svm_pred_36 <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(svm_pred<span class="sc">$</span>svm_pred_36))</span>
<span id="cb2-87"><a href="annexe.html#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Moyennage des resultats de la prediction pour</span></span>
<span id="cb2-88"><a href="annexe.html#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># chaque arbres</span></span>
<span id="cb2-89"><a href="annexe.html#cb2-89" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_pred_arbres_36 <span class="ot">=</span> <span class="fu">aggregate</span>(svm_pred_36 <span class="sc">~</span> code_ech_arbre, </span>
<span id="cb2-90"><a href="annexe.html#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">data =</span> svm_pred, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb2-91"><a href="annexe.html#cb2-91" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Critere choisi sur les observations graphiques</span></span>
<span id="cb2-92"><a href="annexe.html#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_pred_arbres_36<span class="sc">$</span>crit <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb2-93"><a href="annexe.html#cb2-93" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_pred_arbres_36<span class="sc">$</span>crit[svm_pred_arbres_36<span class="sc">$</span>svm_pred_36 <span class="sc">&gt;=</span> </span>
<span id="cb2-94"><a href="annexe.html#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         crit.pos] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-95"><a href="annexe.html#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_pred_arbres_36<span class="sc">$</span>crit[svm_pred_arbres_36<span class="sc">$</span>svm_pred_36 <span class="sc">&lt;=</span> </span>
<span id="cb2-96"><a href="annexe.html#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         crit.neg] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-97"><a href="annexe.html#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Creation d&#39;une nouvelle colonne des resulats issu</span></span>
<span id="cb2-98"><a href="annexe.html#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># de la qPCR, pour comparer à la valeurs predite</span></span>
<span id="cb2-99"><a href="annexe.html#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_pred_arbres_36[<span class="fu">paste</span>(<span class="st">&quot;qPCR&quot;</span>, seuil.ct, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(trueP, </span>
<span id="cb2-100"><a href="annexe.html#cb2-100" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(svm_pred_arbres_36<span class="sc">$</span>code_ech_arbre <span class="sc">%in%</span> </span>
<span id="cb2-101"><a href="annexe.html#cb2-101" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             x))</span>
<span id="cb2-102"><a href="annexe.html#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Résultats de la prédiction sous forme de matrice</span></span>
<span id="cb2-103"><a href="annexe.html#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># de confusion</span></span>
<span id="cb2-104"><a href="annexe.html#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_pred_arbres_36<span class="sc">$</span>crit <span class="ot">&lt;-</span> <span class="fu">factor</span>(svm_pred_arbres_36<span class="sc">$</span>crit, </span>
<span id="cb2-105"><a href="annexe.html#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb2-106"><a href="annexe.html#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_confusion_matrix_36 <span class="ot">&lt;-</span> <span class="fu">ftable</span>(qPCR_36 <span class="sc">~</span> crit, </span>
<span id="cb2-107"><a href="annexe.html#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">data =</span> svm_pred_arbres_36)</span>
<span id="cb2-108"><a href="annexe.html#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_confusion_matrix_36 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(svm_confusion_matrix_36)</span>
<span id="cb2-109"><a href="annexe.html#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     TP_svm <span class="ot">&lt;-</span> svm_confusion_matrix_36[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb2-110"><a href="annexe.html#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     TN_svm <span class="ot">&lt;-</span> svm_confusion_matrix_36[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb2-111"><a href="annexe.html#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     FN_svm <span class="ot">&lt;-</span> svm_confusion_matrix_36[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb2-112"><a href="annexe.html#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     FP_svm <span class="ot">&lt;-</span> svm_confusion_matrix_36[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb2-113"><a href="annexe.html#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Calcul des parametres svm de la matrice de</span></span>
<span id="cb2-114"><a href="annexe.html#cb2-114" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># confusion</span></span>
<span id="cb2-115"><a href="annexe.html#cb2-115" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Accuracy_svm36 <span class="ot">&lt;-</span> ((TP_svm <span class="sc">+</span> TN_svm)<span class="sc">/</span>(TP_svm <span class="sc">+</span> </span>
<span id="cb2-116"><a href="annexe.html#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         TN_svm <span class="sc">+</span> FN_svm <span class="sc">+</span> FP_svm) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb2-117"><a href="annexe.html#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Precision_svm36 <span class="ot">&lt;-</span> ((TP_svm<span class="sc">/</span>(TP_svm <span class="sc">+</span> FP_svm) <span class="sc">*</span> </span>
<span id="cb2-118"><a href="annexe.html#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="dv">100</span>))</span>
<span id="cb2-119"><a href="annexe.html#cb2-119" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Sensitivity_svm36 <span class="ot">&lt;-</span> ((TP_svm<span class="sc">/</span>(TP_svm <span class="sc">+</span> FN_svm) <span class="sc">*</span> </span>
<span id="cb2-120"><a href="annexe.html#cb2-120" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="dv">100</span>))</span>
<span id="cb2-121"><a href="annexe.html#cb2-121" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Parametre_svm_36 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Accuracy_svm36, Precision_svm36, </span>
<span id="cb2-122"><a href="annexe.html#cb2-122" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         Sensitivity_svm36)</span>
<span id="cb2-123"><a href="annexe.html#cb2-123" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Prediction PLS ####</span></span>
<span id="cb2-124"><a href="annexe.html#cb2-124" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     model_pls_36 <span class="ot">&lt;-</span> <span class="fu">plsr</span>(training_set[[<span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, </span>
<span id="cb2-125"><a href="annexe.html#cb2-125" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         seuil.ct)]] <span class="sc">~</span> ., <span class="at">data =</span> training_set[, <span class="fu">grep</span>(<span class="st">&quot;^X&quot;</span>, </span>
<span id="cb2-126"><a href="annexe.html#cb2-126" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="fu">names</span>(training_set))], <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">validation =</span> <span class="st">&quot;CV&quot;</span>)</span>
<span id="cb2-127"><a href="annexe.html#cb2-127" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Prediction</span></span>
<span id="cb2-128"><a href="annexe.html#cb2-128" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     pls_pred <span class="ot">&lt;-</span> test_set</span>
<span id="cb2-129"><a href="annexe.html#cb2-129" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Prediction sur les feuilles de la base</span></span>
<span id="cb2-130"><a href="annexe.html#cb2-130" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># d&#39;apprentissage</span></span>
<span id="cb2-131"><a href="annexe.html#cb2-131" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     pls_pred<span class="sc">$</span>pls_pred_36 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_pls_36, <span class="at">newdata =</span> test_set[, </span>
<span id="cb2-132"><a href="annexe.html#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="fu">grep</span>(<span class="st">&quot;^X&quot;</span>, <span class="fu">names</span>(test_set))], <span class="at">decision.values =</span> T, </span>
<span id="cb2-133"><a href="annexe.html#cb2-133" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">ncomp =</span> <span class="dv">100</span>)</span>
<span id="cb2-134"><a href="annexe.html#cb2-134" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Conversion des resultats de la prediction en</span></span>
<span id="cb2-135"><a href="annexe.html#cb2-135" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># numerique</span></span>
<span id="cb2-136"><a href="annexe.html#cb2-136" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     pls_pred<span class="sc">$</span>pls_pred_36 <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(pls_pred<span class="sc">$</span>pls_pred_36))</span>
<span id="cb2-137"><a href="annexe.html#cb2-137" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Moyennage des resultats de la prediction pour</span></span>
<span id="cb2-138"><a href="annexe.html#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># chaque arbres</span></span>
<span id="cb2-139"><a href="annexe.html#cb2-139" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     pls_pred_arbres_36 <span class="ot">=</span> <span class="fu">aggregate</span>(pls_pred_36 <span class="sc">~</span> code_ech_arbre, </span>
<span id="cb2-140"><a href="annexe.html#cb2-140" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">data =</span> pls_pred, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb2-141"><a href="annexe.html#cb2-141" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Parametrage pour presentation graphique et la</span></span>
<span id="cb2-142"><a href="annexe.html#cb2-142" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># matrice de confusion</span></span>
<span id="cb2-143"><a href="annexe.html#cb2-143" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     pls_pred_arbres_36<span class="sc">$</span>crit <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb2-144"><a href="annexe.html#cb2-144" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     pls_pred_arbres_36<span class="sc">$</span>crit[pls_pred_arbres_36<span class="sc">$</span>pls_pred_36 <span class="sc">&gt;=</span> </span>
<span id="cb2-145"><a href="annexe.html#cb2-145" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         crit.pos] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-146"><a href="annexe.html#cb2-146" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     pls_pred_arbres_36<span class="sc">$</span>crit[pls_pred_arbres_36<span class="sc">$</span>pls_pred_36 <span class="sc">&lt;=</span> </span>
<span id="cb2-147"><a href="annexe.html#cb2-147" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         crit.neg] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-148"><a href="annexe.html#cb2-148" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Creation d&#39;une nouvelle colonne des resulats issu</span></span>
<span id="cb2-149"><a href="annexe.html#cb2-149" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># de la qPCR, pour comparer à la valeurs predite</span></span>
<span id="cb2-150"><a href="annexe.html#cb2-150" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     pls_pred_arbres_36[<span class="fu">paste</span>(<span class="st">&quot;qPCR&quot;</span>, seuil.ct, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(trueP, </span>
<span id="cb2-151"><a href="annexe.html#cb2-151" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(pls_pred_arbres_36<span class="sc">$</span>code_ech_arbre <span class="sc">%in%</span> </span>
<span id="cb2-152"><a href="annexe.html#cb2-152" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             x))</span>
<span id="cb2-153"><a href="annexe.html#cb2-153" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Résultats de la prédiction sous forme de matrice</span></span>
<span id="cb2-154"><a href="annexe.html#cb2-154" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># de confusion</span></span>
<span id="cb2-155"><a href="annexe.html#cb2-155" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     pls_pred_arbres_36<span class="sc">$</span>crit <span class="ot">&lt;-</span> <span class="fu">factor</span>(pls_pred_arbres_36<span class="sc">$</span>crit, </span>
<span id="cb2-156"><a href="annexe.html#cb2-156" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb2-157"><a href="annexe.html#cb2-157" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     pls_confusion_matrix_36 <span class="ot">&lt;-</span> <span class="fu">ftable</span>(qPCR_36 <span class="sc">~</span> crit, </span>
<span id="cb2-158"><a href="annexe.html#cb2-158" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">data =</span> pls_pred_arbres_36)</span>
<span id="cb2-159"><a href="annexe.html#cb2-159" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     pls_confusion_matrix_36 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pls_confusion_matrix_36)</span>
<span id="cb2-160"><a href="annexe.html#cb2-160" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     TP_pls <span class="ot">&lt;-</span> pls_confusion_matrix_36[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb2-161"><a href="annexe.html#cb2-161" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     TN_pls <span class="ot">&lt;-</span> pls_confusion_matrix_36[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb2-162"><a href="annexe.html#cb2-162" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     FN_pls <span class="ot">&lt;-</span> pls_confusion_matrix_36[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb2-163"><a href="annexe.html#cb2-163" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     FP_pls <span class="ot">&lt;-</span> pls_confusion_matrix_36[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb2-164"><a href="annexe.html#cb2-164" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># Calcul des parametres pls de la matrice de</span></span>
<span id="cb2-165"><a href="annexe.html#cb2-165" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="co"># confusion</span></span>
<span id="cb2-166"><a href="annexe.html#cb2-166" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Accuracy_pls36 <span class="ot">&lt;-</span> ((TP_pls <span class="sc">+</span> TN_pls)<span class="sc">/</span>(TP_pls <span class="sc">+</span> </span>
<span id="cb2-167"><a href="annexe.html#cb2-167" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         TN_pls <span class="sc">+</span> FN_pls <span class="sc">+</span> FP_pls) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb2-168"><a href="annexe.html#cb2-168" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Precision_pls36 <span class="ot">&lt;-</span> ((TP_pls<span class="sc">/</span>(TP_pls <span class="sc">+</span> FP_pls) <span class="sc">*</span> </span>
<span id="cb2-169"><a href="annexe.html#cb2-169" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="dv">100</span>))</span>
<span id="cb2-170"><a href="annexe.html#cb2-170" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Sensitivity_pls36 <span class="ot">&lt;-</span> ((TP_pls<span class="sc">/</span>(TP_pls <span class="sc">+</span> FN_pls) <span class="sc">*</span> </span>
<span id="cb2-171"><a href="annexe.html#cb2-171" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="dv">100</span>))</span>
<span id="cb2-172"><a href="annexe.html#cb2-172" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     Parametre_pls_36 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Accuracy_pls36, Precision_pls36, </span>
<span id="cb2-173"><a href="annexe.html#cb2-173" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         Sensitivity_pls36)</span>
<span id="cb2-174"><a href="annexe.html#cb2-174" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     parametre_36 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Parametre_rf_36, Parametre_svm_36, </span>
<span id="cb2-175"><a href="annexe.html#cb2-175" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         Parametre_pls_36)</span>
<span id="cb2-176"><a href="annexe.html#cb2-176" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     All_parametre_36 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(parametre_36)</span>
<span id="cb2-177"><a href="annexe.html#cb2-177" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="fu">names</span>(All_parametre_36) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rownames</span>(parametre_36))</span>
<span id="cb2-178"><a href="annexe.html#cb2-178" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     All_parametre_36</span>
<span id="cb2-179"><a href="annexe.html#cb2-179" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> }</span></code></pre></div>
<p></p>
</div>
<div id="annexe-3-matrice-de-confusion-des-3-méthodes-de-machin-learning" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Annexe 3 : Matrice de confusion des 3 méthodes de machin learning</h2>
<p></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="annexe.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Library ####</span></span>
<span id="cb3-2"><a href="annexe.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">library</span>(pls)  <span class="co"># package pls</span></span>
<span id="cb3-3"><a href="annexe.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(randomForest)  <span class="co"># package RF</span></span>
<span id="cb3-4"><a href="annexe.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(e1071)  <span class="co"># package SVM</span></span>
<span id="cb3-5"><a href="annexe.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(tidyr)  <span class="co"># pivot longer &amp; pivot wider</span></span>
<span id="cb3-6"><a href="annexe.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(snowfall)  <span class="co"># Utilisation du calcul paralell pour optimiser la vitesse de calcul</span></span>
<span id="cb3-7"><a href="annexe.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Importation des fonctions utiles</span></span>
<span id="cb3-8"><a href="annexe.html#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">source</span>(<span class="at">file =</span> <span class="st">&quot;Fct_ConfusionMatrix_ct36.R&quot;</span>)  <span class="co"># Annex 2</span></span>
<span id="cb3-9"><a href="annexe.html#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> nb.simu <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># Minimu 1000 simu</span></span>
<span id="cb3-10"><a href="annexe.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> rep.max <span class="ot">&lt;-</span> <span class="dv">6</span>  <span class="co"># nombre de repetition SPIR sur les feuilles , maximum 6</span></span>
<span id="cb3-11"><a href="annexe.html#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Tirage <span class="ot">&lt;-</span> <span class="fu">split</span>(data_SPIR_Ed, data_SPIR_Ed<span class="sc">$</span>code_ech_feuille, </span>
<span id="cb3-12"><a href="annexe.html#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">drop =</span> T)  <span class="co"># drop = T pour enlever les tiroirs vides !!</span></span>
<span id="cb3-13"><a href="annexe.html#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Calcul parralelle</span></span>
<span id="cb3-14"><a href="annexe.html#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">sfInit</span>(<span class="at">parallel =</span> T, <span class="at">cpus =</span> <span class="dv">4</span>)  <span class="co"># optimisation des processeurs sur les 4 coeurs</span></span>
<span id="cb3-15"><a href="annexe.html#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(caTools)  <span class="co"># la library des packages utilisés</span></span>
<span id="cb3-16"><a href="annexe.html#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(pls)</span>
<span id="cb3-17"><a href="annexe.html#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(randomForest)</span>
<span id="cb3-18"><a href="annexe.html#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(e1071)</span>
<span id="cb3-19"><a href="annexe.html#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(caret)</span>
<span id="cb3-20"><a href="annexe.html#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfExport</span>(<span class="st">&quot;fct_ConfusionMatrix&quot;</span>, <span class="st">&quot;Tirage&quot;</span>, <span class="st">&quot;rep.max&quot;</span>, </span>
<span id="cb3-21"><a href="annexe.html#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="st">&quot;nb.simu&quot;</span>, <span class="st">&quot;trueP&quot;</span>)  <span class="co"># les éléments extérieur à la fonction</span></span>
<span id="cb3-22"><a href="annexe.html#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> T1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()  <span class="co"># information sur le temps que met l&#39;operation a se realiser</span></span>
<span id="cb3-23"><a href="annexe.html#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># res.svm.36 &lt;- sfClusterApplySR(rep(1:rep.max,</span></span>
<span id="cb3-24"><a href="annexe.html#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># each = nb.simu), fct_svm , seuil.ct = 36 ,</span></span>
<span id="cb3-25"><a href="annexe.html#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># list.feuilles= Tirage , restore = F, perUpdate =</span></span>
<span id="cb3-26"><a href="annexe.html#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># 6 ) # restore = T seulement si ça plante !</span></span>
<span id="cb3-27"><a href="annexe.html#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> res.ML<span class="fl">.36</span> <span class="ot">&lt;-</span> <span class="fu">sfClusterApplyLB</span>(<span class="fu">rep</span>(rep.max, <span class="at">each =</span> nb.simu), </span>
<span id="cb3-28"><a href="annexe.html#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     fct_ConfusionMatrix, <span class="at">seuil.ct =</span> <span class="dv">36</span>, <span class="at">list.feuilles =</span> Tirage)</span>
<span id="cb3-29"><a href="annexe.html#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># fct_svm on remplsis les 3 arguments qui sont :</span></span>
<span id="cb3-30"><a href="annexe.html#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># nb.rep, seuil.ct, list.feuilles</span></span>
<span id="cb3-31"><a href="annexe.html#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> T2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb3-32"><a href="annexe.html#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfStop</span>()  <span class="co"># stop l&#39;utilisation du sfInit aux autres lignes de codes</span></span>
<span id="cb3-33"><a href="annexe.html#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">difftime</span>(T2, T1)  <span class="co"># information sur le temps qu&#39;à mis l&#39;operation </span></span>
<span id="cb3-34"><a href="annexe.html#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> intermed<span class="fl">.36</span> <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, res.ML<span class="fl">.36</span>))</span>
<span id="cb3-35"><a href="annexe.html#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># permet de basculer de la liste à la data.frame</span></span>
<span id="cb3-36"><a href="annexe.html#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># pour le resultat issu de sfClusterApplyLB</span></span>
<span id="cb3-37"><a href="annexe.html#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> ML_global<span class="fl">.36</span> <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>((intermed<span class="fl">.36</span>), <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, </span>
<span id="cb3-38"><a href="annexe.html#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">names_to =</span> <span class="st">&quot;critere&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;valeurs&quot;</span>)</span>
<span id="cb3-39"><a href="annexe.html#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># On moyenne tout les parametres pour chaque type</span></span>
<span id="cb3-40"><a href="annexe.html#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># de machin learning</span></span>
<span id="cb3-41"><a href="annexe.html#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> ML<span class="fl">.36</span> <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(valeurs <span class="sc">~</span> critere, ML_global<span class="fl">.36</span>, </span>
<span id="cb3-42"><a href="annexe.html#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     mean)</span>
<span id="cb3-43"><a href="annexe.html#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">names</span>(ML<span class="fl">.36</span>)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Moyenne&quot;</span></span>
<span id="cb3-44"><a href="annexe.html#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Meme chose avec l&#39;ecart type</span></span>
<span id="cb3-45"><a href="annexe.html#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> ML<span class="fl">.36</span><span class="sc">$</span>et <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(valeurs <span class="sc">~</span> critere, ML_global<span class="fl">.36</span>, </span>
<span id="cb3-46"><a href="annexe.html#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     sd)<span class="sc">$</span>valeurs</span>
<span id="cb3-47"><a href="annexe.html#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> ML<span class="fl">.36</span></span></code></pre></div>
<p></p>
</div>
<div id="annexe-4-fonction-nombre-de-feuille" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Annexe 4 : Fonction nombre de feuille</h2>
<p></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="annexe.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fct_feuille <span class="ot">&lt;-</span> <span class="cf">function</span>(nb.feuille, seuil.ct, list.arbres) {</span>
<span id="cb4-2"><a href="annexe.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     maliste <span class="ot">&lt;-</span> <span class="fu">lapply</span>(list.arbres, <span class="cf">function</span>(arbre) {</span>
<span id="cb4-3"><a href="annexe.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="cf">if</span> (nb.feuille <span class="sc">&lt;</span> <span class="fu">nrow</span>(arbre)) </span>
<span id="cb4-4"><a href="annexe.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             list_svm <span class="ot">&lt;-</span> arbre[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(arbre<span class="sc">$</span>code_ech_arbre), </span>
<span id="cb4-5"><a href="annexe.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 nb.feuille), ] <span class="cf">else</span> list_svm <span class="ot">&lt;-</span> arbre</span>
<span id="cb4-6"><a href="annexe.html#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="co"># on fait ça pour tte les feuilles mais tjrs en</span></span>
<span id="cb4-7"><a href="annexe.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="co"># choisissant le nombre de rep tire aleatoirement</span></span>
<span id="cb4-8"><a href="annexe.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         code <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;^code_ech&quot;</span>, <span class="fu">names</span>(list_svm))</span>
<span id="cb4-9"><a href="annexe.html#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         qPCR <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;^qPCR_&quot;</span>, <span class="fu">names</span>(list_svm))</span>
<span id="cb4-10"><a href="annexe.html#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         sortie <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="fu">unique</span>(list_svm[<span class="fu">c</span>(code, </span>
<span id="cb4-11"><a href="annexe.html#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             qPCR)]), <span class="fu">matrix</span>(<span class="fu">apply</span>(list_svm[<span class="sc">-</span>(<span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb4-12"><a href="annexe.html#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="st">&quot;code_ech_feuille&quot;</span>)<span class="sc">:</span><span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb4-13"><a href="annexe.html#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="st">&quot;qPCR_36&quot;</span>))], <span class="dv">2</span>, mean), <span class="at">nr =</span> <span class="dv">1</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, </span>
<span id="cb4-14"><a href="annexe.html#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="fu">names</span>(list_svm)[<span class="sc">-</span>(<span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb4-15"><a href="annexe.html#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="st">&quot;code_ech_feuille&quot;</span>)<span class="sc">:</span><span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb4-16"><a href="annexe.html#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="st">&quot;qPCR_36&quot;</span>))])))</span>
<span id="cb4-17"><a href="annexe.html#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         sortie</span>
<span id="cb4-18"><a href="annexe.html#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     })</span>
<span id="cb4-19"><a href="annexe.html#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     test_ed <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, maliste)  <span class="co"># on colle toute les listes créées précédement </span></span>
<span id="cb4-20"><a href="annexe.html#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     decoup <span class="ot">&lt;-</span> <span class="fu">sample.split</span>(test_ed[, <span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, </span>
<span id="cb4-21"><a href="annexe.html#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         seuil.ct)], <span class="at">SplitRatio =</span> <span class="fl">0.75</span>)  <span class="co"># on decoupe le jeu de donné en training set et test set</span></span>
<span id="cb4-22"><a href="annexe.html#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     training_set <span class="ot">&lt;-</span> test_ed[decoup, ]</span>
<span id="cb4-23"><a href="annexe.html#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     test_set <span class="ot">&lt;-</span> test_ed[<span class="sc">!</span>decoup, ]</span>
<span id="cb4-24"><a href="annexe.html#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     res.svm <span class="ot">&lt;-</span> <span class="fu">svm</span>(<span class="at">y =</span> training_set[, <span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, </span>
<span id="cb4-25"><a href="annexe.html#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         seuil.ct)]  <span class="co"># ici on prend les seuil donc sois 32 sois 36 , avec &#39;paste0&#39; colle sans separateurs</span></span>
<span id="cb4-26"><a href="annexe.html#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> , </span>
<span id="cb4-27"><a href="annexe.html#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">x =</span> training_set[, <span class="fu">grep</span>(<span class="st">&quot;^X&quot;</span>, <span class="fu">names</span>(training_set))]  <span class="co">#  ici on prend ttes les longueurs d&#39;ondes</span></span>
<span id="cb4-28"><a href="annexe.html#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> , </span>
<span id="cb4-29"><a href="annexe.html#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">type =</span> <span class="st">&quot;C-classification&quot;</span>, <span class="at">kernel =</span> <span class="st">&quot;linear&quot;</span>)</span>
<span id="cb4-30"><a href="annexe.html#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(res.svm, <span class="at">newdata =</span> test_set[, </span>
<span id="cb4-31"><a href="annexe.html#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="fu">grep</span>(<span class="st">&quot;^X&quot;</span>, <span class="fu">names</span>(test_set))])</span>
<span id="cb4-32"><a href="annexe.html#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm.confusion <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="at">data =</span> svm_pred, </span>
<span id="cb4-33"><a href="annexe.html#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">reference =</span> test_set[, <span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, seuil.ct)])</span>
<span id="cb4-34"><a href="annexe.html#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     sortie <span class="ot">&lt;-</span> <span class="fu">c</span>(svm.confusion<span class="sc">$</span>overall[<span class="dv">1</span>], svm.confusion<span class="sc">$</span>byClass[<span class="dv">1</span>], </span>
<span id="cb4-35"><a href="annexe.html#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         svm.confusion<span class="sc">$</span>byClass[<span class="dv">3</span>])  <span class="co"># combine les 3 parametres recherches </span></span>
<span id="cb4-36"><a href="annexe.html#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="fu">names</span>(sortie) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Accuracy&quot;</span>, <span class="st">&quot;Sensitivity&quot;</span>, <span class="st">&quot;Precision&quot;</span>)  <span class="co"># renomer</span></span>
<span id="cb4-37"><a href="annexe.html#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     sortie</span>
<span id="cb4-38"><a href="annexe.html#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> }</span></code></pre></div>
<p></p>
</div>
<div id="annexe-5-prédiction-du-nombre-optimal-de-feuille" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Annexe 5 : Prédiction du nombre optimal de feuille</h2>
<p></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="annexe.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())  <span class="co"># nettoyage des listes de l&#39;environnement de travail</span></span>
<span id="cb5-2"><a href="annexe.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Library ####</span></span>
<span id="cb5-3"><a href="annexe.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">library</span>(pls)  <span class="co"># PLS</span></span>
<span id="cb5-4"><a href="annexe.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(ggplot2)  <span class="co"># Package ggplot pour graphiques</span></span>
<span id="cb5-5"><a href="annexe.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(ggdark)  <span class="co"># Met un style de graphique ggplot en noir</span></span>
<span id="cb5-6"><a href="annexe.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(ggpubr)  <span class="co"># Utilisation de la fonction ggarrange qui permet de coller 2 graphiques</span></span>
<span id="cb5-7"><a href="annexe.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(caTools)  <span class="co"># sample.split</span></span>
<span id="cb5-8"><a href="annexe.html#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(tidyr)  <span class="co"># pivot longer &amp; pivot wider</span></span>
<span id="cb5-9"><a href="annexe.html#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(snowfall)  <span class="co"># Utilisation du calcul paralell pour optimiser la vitesse de calcul</span></span>
<span id="cb5-10"><a href="annexe.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Importation des fonctions utiles</span></span>
<span id="cb5-11"><a href="annexe.html#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">source</span>(<span class="at">file =</span> <span class="st">&quot;Scripts/Prediction/Fct_Feuilles.R&quot;</span>)  <span class="co"># fonction feuille avec SVM</span></span>
<span id="cb5-12"><a href="annexe.html#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Importation du jeu de donnee Global</span></span>
<span id="cb5-13"><a href="annexe.html#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">load</span>(<span class="st">&quot;Sauvegardes_objet_R.data/Jeux de donnee/data_SPIR_Ed.Rdata&quot;</span>)</span>
<span id="cb5-14"><a href="annexe.html#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># I) Parametres SVM Ct&lt;36 ####</span></span>
<span id="cb5-15"><a href="annexe.html#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> nb.simu <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># Minimu 1000 simu  Time difference of 15.39098 hours pour 1000 simu</span></span>
<span id="cb5-16"><a href="annexe.html#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> nb.feuille <span class="ot">&lt;-</span> <span class="dv">10</span>  <span class="co"># nombre de feuilles echantillonees par arbre , maximum 10</span></span>
<span id="cb5-17"><a href="annexe.html#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> seuil.ct <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb5-18"><a href="annexe.html#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> intermed.arbre <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(reflectance <span class="sc">~</span> code_ech_feuille <span class="sc">+</span> </span>
<span id="cb5-19"><a href="annexe.html#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     code_ech_arbre <span class="sc">+</span> qPCR_32 <span class="sc">+</span> qPCR_36 <span class="sc">+</span> lambda, <span class="at">data =</span> data_long_Ed, </span>
<span id="cb5-20"><a href="annexe.html#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     mean)</span>
<span id="cb5-21"><a href="annexe.html#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> mean.arbre <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(intermed.arbre, <span class="at">names_from =</span> <span class="st">&quot;lambda&quot;</span>, </span>
<span id="cb5-22"><a href="annexe.html#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">values_from =</span> <span class="st">&quot;reflectance&quot;</span>, <span class="at">names_prefix =</span> <span class="st">&quot;X&quot;</span>)</span>
<span id="cb5-23"><a href="annexe.html#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Tirage <span class="ot">&lt;-</span> <span class="fu">split</span>(mean.arbre, mean.arbre<span class="sc">$</span>code_ech_arbre, </span>
<span id="cb5-24"><a href="annexe.html#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">drop =</span> T)  <span class="co"># drop = T pour enlever les tiroirs vide</span></span>
<span id="cb5-25"><a href="annexe.html#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="do">## I.a) Calcul parallele ####</span></span>
<span id="cb5-26"><a href="annexe.html#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">sfInit</span>(<span class="at">parallel =</span> T, <span class="at">cpus =</span> <span class="dv">4</span>)  <span class="co"># optimisation des processeurs sur les 4 coeurs</span></span>
<span id="cb5-27"><a href="annexe.html#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(caTools)  <span class="co"># la library des packages utilisés</span></span>
<span id="cb5-28"><a href="annexe.html#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(e1071)</span>
<span id="cb5-29"><a href="annexe.html#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(pls)</span>
<span id="cb5-30"><a href="annexe.html#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(caret)</span>
<span id="cb5-31"><a href="annexe.html#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfExport</span>(<span class="st">&quot;fct_feuille&quot;</span>, <span class="st">&quot;Tirage&quot;</span>, <span class="st">&quot;nb.feuille&quot;</span>, <span class="st">&quot;nb.simu&quot;</span>)  <span class="co"># les elements exterieur a la fonction</span></span>
<span id="cb5-32"><a href="annexe.html#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> T1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()  <span class="co"># information sur le temps que met l&#39;operation a se realiser</span></span>
<span id="cb5-33"><a href="annexe.html#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># res.svm.36 &lt;- sfClusterApplySR(rep(1:rep.max,</span></span>
<span id="cb5-34"><a href="annexe.html#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># each = nb.simu), fct_svm , seuil.ct = 36 ,</span></span>
<span id="cb5-35"><a href="annexe.html#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># list.feuilles= Tirage , restore = F, perUpdate =</span></span>
<span id="cb5-36"><a href="annexe.html#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># 6 ) # restore = T seulement si ça plante !</span></span>
<span id="cb5-37"><a href="annexe.html#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> res.svm<span class="fl">.36</span> <span class="ot">&lt;-</span> <span class="fu">sfClusterApplyLB</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>nb.feuille, <span class="at">each =</span> nb.simu), </span>
<span id="cb5-38"><a href="annexe.html#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     fct_feuille, <span class="at">seuil.ct =</span> <span class="dv">36</span>, <span class="at">list.arbres =</span> Tirage)</span>
<span id="cb5-39"><a href="annexe.html#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># fct_svm on remplsis les 3 arguments qui sont :</span></span>
<span id="cb5-40"><a href="annexe.html#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># nb.rep, seuil.ct, list.feuilles</span></span>
<span id="cb5-41"><a href="annexe.html#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> T2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb5-42"><a href="annexe.html#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfStop</span>()  <span class="co"># stop l&#39;utilisation du sfInit aux autres lignes de codes</span></span>
<span id="cb5-43"><a href="annexe.html#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">difftime</span>(T2, T1)  <span class="co"># information sur le temps qu&#39;a mis l&#39;operation </span></span>
<span id="cb5-44"><a href="annexe.html#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="do">## I.b) Enregistrement des criteres de precision</span></span>
<span id="cb5-45"><a href="annexe.html#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="do">## ####</span></span>
<span id="cb5-46"><a href="annexe.html#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># load(&#39;Sauvegardes_objet_R.data/SVM_ct36_6rep_100simu_3cpu_sfClusterApplyLB.Rdata&#39;)</span></span>
<span id="cb5-47"><a href="annexe.html#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> intermed<span class="fl">.36</span> <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, res.svm<span class="fl">.36</span>))</span>
<span id="cb5-48"><a href="annexe.html#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># permet de basculer de la liste à la data.frame</span></span>
<span id="cb5-49"><a href="annexe.html#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># pour le resultat issu de sfClusterApplyLB</span></span>
<span id="cb5-50"><a href="annexe.html#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> data_global<span class="fl">.36</span> <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>((intermed<span class="fl">.36</span>), <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb5-51"><a href="annexe.html#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">names_to =</span> <span class="st">&quot;critere&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;valeurs&quot;</span>)</span>
<span id="cb5-52"><a href="annexe.html#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_global<span class="fl">.36</span><span class="sc">$</span>nb.rep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>nb.feuille, <span class="at">each =</span> (nb.simu <span class="sc">*</span> </span>
<span id="cb5-53"><a href="annexe.html#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="dv">3</span>))</span></code></pre></div>
<p></p>
</div>
<div id="annexe-6-fonction-nombre-de-répétition-spir-par-feuille" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Annexe 6 : Fonction nombre de répétition SPIR par feuille</h2>
<p></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="annexe.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fct_svm <span class="ot">&lt;-</span> <span class="cf">function</span>(nb.rep, seuil.ct, list.feuilles) {</span>
<span id="cb6-2"><a href="annexe.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     maliste <span class="ot">&lt;-</span> <span class="fu">lapply</span>(list.feuilles, <span class="cf">function</span>(feuille) {</span>
<span id="cb6-3"><a href="annexe.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="co"># On cree une list qui piochera au hazard 1 feuille</span></span>
<span id="cb6-4"><a href="annexe.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="co"># avec le nombre de rep correspondant</span></span>
<span id="cb6-5"><a href="annexe.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="cf">if</span> (nb.rep <span class="sc">&lt;</span> <span class="fu">nrow</span>(feuille)) </span>
<span id="cb6-6"><a href="annexe.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             list_svm <span class="ot">&lt;-</span> feuille[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(feuille<span class="sc">$</span>code_ech_feuille), </span>
<span id="cb6-7"><a href="annexe.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 nb.rep), ] <span class="cf">else</span> list_svm <span class="ot">&lt;-</span> feuille</span>
<span id="cb6-8"><a href="annexe.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="co"># on fait ça pour tte les feuilles mais tjrs en</span></span>
<span id="cb6-9"><a href="annexe.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="co"># choisissant le nombre de rep tire aleatoirement</span></span>
<span id="cb6-10"><a href="annexe.html#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         code <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;^code_ech&quot;</span>, <span class="fu">names</span>(list_svm))</span>
<span id="cb6-11"><a href="annexe.html#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         qPCR <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;^qPCR_&quot;</span>, <span class="fu">names</span>(list_svm))</span>
<span id="cb6-12"><a href="annexe.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         sortie <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="fu">unique</span>(list_svm[<span class="fu">c</span>(code, </span>
<span id="cb6-13"><a href="annexe.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             qPCR)]), <span class="fu">matrix</span>(<span class="fu">apply</span>(list_svm[<span class="sc">-</span>(<span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb6-14"><a href="annexe.html#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="st">&quot;code_nbr_rep&quot;</span>)<span class="sc">:</span><span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb6-15"><a href="annexe.html#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="st">&quot;qPCR_36&quot;</span>))], <span class="dv">2</span>, mean)  <span class="co"># on moyenne la valeur des rep pour chaque feuille</span></span>
<span id="cb6-16"><a href="annexe.html#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> , </span>
<span id="cb6-17"><a href="annexe.html#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="at">nr =</span> <span class="dv">1</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">names</span>(list_svm)[<span class="sc">-</span>(<span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb6-18"><a href="annexe.html#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="st">&quot;code_nbr_rep&quot;</span>)<span class="sc">:</span><span class="fu">which</span>(<span class="fu">colnames</span>(list_svm) <span class="sc">==</span> </span>
<span id="cb6-19"><a href="annexe.html#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="st">&quot;qPCR_36&quot;</span>))])))</span>
<span id="cb6-20"><a href="annexe.html#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         sortie</span>
<span id="cb6-21"><a href="annexe.html#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     })</span>
<span id="cb6-22"><a href="annexe.html#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     test_ed <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, maliste)  <span class="co"># on colle toute les listes créées précédement </span></span>
<span id="cb6-23"><a href="annexe.html#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     decoup <span class="ot">&lt;-</span> <span class="fu">sample.split</span>(test_ed[, <span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, </span>
<span id="cb6-24"><a href="annexe.html#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         seuil.ct)], <span class="at">SplitRatio =</span> <span class="fl">0.75</span>)  <span class="co"># on decoupe le jeu de donné en training set et test set</span></span>
<span id="cb6-25"><a href="annexe.html#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     training_set <span class="ot">&lt;-</span> test_ed[decoup, ]</span>
<span id="cb6-26"><a href="annexe.html#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     test_set <span class="ot">&lt;-</span> test_ed[<span class="sc">!</span>decoup, ]</span>
<span id="cb6-27"><a href="annexe.html#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     res.svm <span class="ot">&lt;-</span> <span class="fu">svm</span>(<span class="at">y =</span> training_set[, <span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, </span>
<span id="cb6-28"><a href="annexe.html#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         seuil.ct)]  <span class="co"># ici on prend les seuil donc sois 32 sois 36 , avec &#39;paste0&#39; colle sans separateurs</span></span>
<span id="cb6-29"><a href="annexe.html#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> , </span>
<span id="cb6-30"><a href="annexe.html#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">x =</span> training_set[, <span class="fu">grep</span>(<span class="st">&quot;^X&quot;</span>, <span class="fu">names</span>(training_set))]  <span class="co"># ici on prend ttes les longueurs d&#39;ondes</span></span>
<span id="cb6-31"><a href="annexe.html#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> , </span>
<span id="cb6-32"><a href="annexe.html#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">type =</span> <span class="st">&quot;C-classification&quot;</span>, <span class="at">kernel =</span> <span class="st">&quot;linear&quot;</span>)</span>
<span id="cb6-33"><a href="annexe.html#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(res.svm, <span class="at">newdata =</span> test_set[, </span>
<span id="cb6-34"><a href="annexe.html#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="fu">grep</span>(<span class="st">&quot;^X&quot;</span>, <span class="fu">names</span>(test_set))])</span>
<span id="cb6-35"><a href="annexe.html#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     svm.confusion <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="at">data =</span> svm_pred, </span>
<span id="cb6-36"><a href="annexe.html#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="at">reference =</span> test_set[, <span class="fu">paste0</span>(<span class="st">&quot;qPCR_&quot;</span>, seuil.ct)])</span>
<span id="cb6-37"><a href="annexe.html#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     sortie <span class="ot">&lt;-</span> <span class="fu">c</span>(svm.confusion<span class="sc">$</span>overall[<span class="dv">1</span>], svm.confusion<span class="sc">$</span>byClass[<span class="dv">1</span>], </span>
<span id="cb6-38"><a href="annexe.html#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         svm.confusion<span class="sc">$</span>byClass[<span class="dv">3</span>])  <span class="co"># combine les 3 parametres recherches </span></span>
<span id="cb6-39"><a href="annexe.html#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="fu">names</span>(sortie) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Accuracy&quot;</span>, <span class="st">&quot;Sensitivity&quot;</span>, <span class="st">&quot;Precision&quot;</span>)</span>
<span id="cb6-40"><a href="annexe.html#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     sortie</span>
<span id="cb6-41"><a href="annexe.html#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> }</span></code></pre></div>
<p></p>
</div>
<div id="annexe-7-prédiction-du-nombre-de-répétition-optimal" class="section level2" number="6.7">
<h2><span class="header-section-number">6.7</span> Annexe 7 : Prédiction du nombre de répétition optimal</h2>
<p></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="annexe.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Library ####</span></span>
<span id="cb7-2"><a href="annexe.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">library</span>(e1071)  <span class="co"># SVM</span></span>
<span id="cb7-3"><a href="annexe.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(pls)  <span class="co"># PLS</span></span>
<span id="cb7-4"><a href="annexe.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(ggplot2)  <span class="co"># Package ggplot pour graphiques</span></span>
<span id="cb7-5"><a href="annexe.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(ggdark)  <span class="co"># Met un style de graphique ggplot en noir</span></span>
<span id="cb7-6"><a href="annexe.html#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(ggpubr)  <span class="co"># Utilisation de la fonction ggarrange qui permet de coller 2 graphiques</span></span>
<span id="cb7-7"><a href="annexe.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(caTools)  <span class="co"># sample.split</span></span>
<span id="cb7-8"><a href="annexe.html#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(tidyr)  <span class="co"># pivot longer &amp; pivot wider</span></span>
<span id="cb7-9"><a href="annexe.html#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(caret)  <span class="co"># fonction confusionMatrix</span></span>
<span id="cb7-10"><a href="annexe.html#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(snowfall)  <span class="co"># Utilisation du calcul paralell pour optimiser la vitesse de calcul</span></span>
<span id="cb7-11"><a href="annexe.html#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Importation des fonctions utiles</span></span>
<span id="cb7-12"><a href="annexe.html#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">source</span>(<span class="at">file =</span> <span class="st">&quot;Scripts/Prediction/Fct_SVM.R&quot;</span>)  <span class="co"># pour calculer avec fonction svm</span></span>
<span id="cb7-13"><a href="annexe.html#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># source(file = &#39;Scripts/Prediction/Fct_PLS.R&#39;) #</span></span>
<span id="cb7-14"><a href="annexe.html#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># pour calculer avec fonction pls</span></span>
<span id="cb7-15"><a href="annexe.html#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># Importation du jeu de donnee Global</span></span>
<span id="cb7-16"><a href="annexe.html#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">load</span>(<span class="st">&quot;Sauvegardes_objet_R.data/Jeux de donnee/data_SPIR_Ed.Rdata&quot;</span>)</span>
<span id="cb7-17"><a href="annexe.html#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># I) Parametres SVM Ct&lt;36 ####</span></span>
<span id="cb7-18"><a href="annexe.html#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> nb.simu <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># nombre de simulation</span></span>
<span id="cb7-19"><a href="annexe.html#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> rep.max <span class="ot">&lt;-</span> <span class="dv">6</span>  <span class="co"># nombre de repetition SPIR sur les feuilles , maximum 6</span></span>
<span id="cb7-20"><a href="annexe.html#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Tirage <span class="ot">&lt;-</span> <span class="fu">split</span>(data_SPIR_Ed[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)], data_SPIR_Ed<span class="sc">$</span>code_ech_feuille, </span>
<span id="cb7-21"><a href="annexe.html#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">drop =</span> T)  <span class="co"># drop = T pour enlever les tiroirs vides !</span></span>
<span id="cb7-22"><a href="annexe.html#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="do">## I.a) Calcul parallele ####</span></span>
<span id="cb7-23"><a href="annexe.html#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">sfInit</span>(<span class="at">parallel =</span> T, <span class="at">cpus =</span> <span class="dv">4</span>)  <span class="co"># optimisation des processeurs sur les 4 coeurs</span></span>
<span id="cb7-24"><a href="annexe.html#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(caTools)  <span class="co"># la library des packages utilisés</span></span>
<span id="cb7-25"><a href="annexe.html#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(e1071)  <span class="co"># pour fct_svm</span></span>
<span id="cb7-26"><a href="annexe.html#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(pls)  <span class="co"># pour fct_pls</span></span>
<span id="cb7-27"><a href="annexe.html#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfLibrary</span>(caret)</span>
<span id="cb7-28"><a href="annexe.html#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfExport</span>(<span class="st">&quot;fct_svm&quot;</span>, <span class="st">&quot;Tirage&quot;</span>, <span class="st">&quot;rep.max&quot;</span>, <span class="st">&quot;nb.simu&quot;</span>)  <span class="co"># les elements exterieur a la fonction </span></span>
<span id="cb7-29"><a href="annexe.html#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> T1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()  <span class="co"># information sur le temps que met l&#39;operation a se realiser</span></span>
<span id="cb7-30"><a href="annexe.html#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> res.svm<span class="fl">.36</span> <span class="ot">&lt;-</span> <span class="fu">sfClusterApplyLB</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>rep.max, <span class="at">each =</span> nb.simu), </span>
<span id="cb7-31"><a href="annexe.html#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     fct_svm, <span class="at">seuil.ct =</span> <span class="dv">36</span>, <span class="at">list.feuilles =</span> Tirage)</span>
<span id="cb7-32"><a href="annexe.html#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># fct_svm on remplsis les 3 arguments qui sont :</span></span>
<span id="cb7-33"><a href="annexe.html#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># nb.rep, seuil.ct, list.feuilles</span></span>
<span id="cb7-34"><a href="annexe.html#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> T2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb7-35"><a href="annexe.html#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sfStop</span>()  <span class="co"># stop l&#39;utilisation du sfInit aux autres lignes de codes</span></span>
<span id="cb7-36"><a href="annexe.html#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">difftime</span>(T2, T1)  <span class="co"># information sur le temps qu&#39;a mis l&#39;operation </span></span>
<span id="cb7-37"><a href="annexe.html#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="do">## I.b) Enregistrement des criteres de precision</span></span>
<span id="cb7-38"><a href="annexe.html#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="do">## ####</span></span>
<span id="cb7-39"><a href="annexe.html#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># load(&#39;Sauvegardes_objet_R.data/SVM_ct36_6rep_100simu_3cpu_sfClusterApplyLB.Rdata&#39;)</span></span>
<span id="cb7-40"><a href="annexe.html#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> intermed<span class="fl">.36</span> <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, res.svm<span class="fl">.36</span>))</span>
<span id="cb7-41"><a href="annexe.html#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># permet de basculer de la liste à la data.frame</span></span>
<span id="cb7-42"><a href="annexe.html#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># pour le resultat issu de sfClusterApplyLB</span></span>
<span id="cb7-43"><a href="annexe.html#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> data_global<span class="fl">.36</span> <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>((intermed<span class="fl">.36</span>), <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb7-44"><a href="annexe.html#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="at">names_to =</span> <span class="st">&quot;critere&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;valeurs&quot;</span>)</span>
<span id="cb7-45"><a href="annexe.html#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> data_global<span class="fl">.36</span><span class="sc">$</span>nb.rep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>rep.max, <span class="at">each =</span> (rep.max <span class="sc">*</span> </span>
<span id="cb7-46"><a href="annexe.html#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     nb.simu<span class="sc">/</span><span class="dv">2</span>))</span></code></pre></div>
<p></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="conclusion.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bibliographie.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Rapport Edouard.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
